{"version":3,"file":"Index-5c016a3e.js","sources":["../../../cms-frontend/src/assets/images/logo/logo.svg","../../../cms-frontend/src/utils/format-access.js","../../../cms-frontend/src/utils/format-routes.js","../../../cms-frontend/src/views/Login/Index.vue"],"sourcesContent":["export default \"__VITE_ASSET__78329abd__\"","const access = {} \n\nexport default function formatAccess(routers) {\n    //簡單檢查是否是可以處理的數據\n    if (!(routers instanceof Array)) {\n        return false;\n    }\n    //處理後的容器\n    routers.forEach(({ id, assets, apis }) => {\n        //遞歸處理\n        if (assets && assets instanceof Array) {\n            assets = formatAccess(assets);\n        }\n\n        if ( id && apis && apis.length)\n            access[id] = apis.filter( api => api.checked === 1).map( api => api.method)\n    });\n    return access;\n}\n","export default function formatRoutes(routers, root = false, parentId = undefined) {\n  //簡單檢查是否是可以處理的數據\n  if (!(routers instanceof Array)) {\n    return false\n  }\n  //處理後的容器\n  let fmRouters = []\n  routers.forEach((router) => {\n    // 取得 router 內變數\n    let {\n      path,\n      full_path, // 要註意，以 / 開頭的嵌套路徑會被當作根路徑。 這讓你充分的使用嵌套組件而無須設置嵌套的路徑。\n      component,\n      title,\n      redirect,\n      assets,\n      icon,\n      showNav,\n      type,\n      id,\n      edit,\n      apis,\n      visible,\n    } = router\n\n    const hasChildren = (menu) => {\n      if (menu.type !== 'alias') return true\n      return menu.assets.some(({ visible }) => visible)\n    }\n\n    if (visible && hasChildren(router)) {\n    //   component = component ? component : 'layout'\n      //如果有子組件，遞歸處理\n      if (assets && assets instanceof Array) {\n        assets = formatRoutes(assets, false, id)\n      }\n      let fmRouter = {\n        path: full_path || path,\n        /* component: () => {\n                    //拚出相對路徑，由於component無法識別變量\n                    //利用Webpack 的 Code-Splitting 功能\n                    return component === \"layout\"\n                        ? import(\"layout/index\")\n                        : import(\"views/\" + component);\n                }, */\n        name: title,\n        children: assets,\n        meta: {\n          icon,\n          showNav,\n          type,\n          id,\n          parentId: parentId || id, // 控制台沒有 parent\n        },\n      }\n      if (redirect) {\n        fmRouter.redirect = redirect\n      }\n      fmRouters.push(fmRouter)\n\n      // 後端不再回傳編輯頁路由，改由前端自行生成；權限部分繼承自 list 頁\n      if (component.includes('list') && edit !== false) {\n        const editRouter = {\n          path: path + '/edit',\n          // component: () => import(\"views/\" + component.replace('list', 'edit')),\n          name: 'EDIT-' + title,\n          meta: {\n            icon,\n            showNav: 0,\n            type: 'function',\n            id,\n            parentId: parentId || id,\n          },\n        }\n        fmRouters.push(editRouter)\n      }\n    }\n  })\n  // console.log(fmRouters)\n\n  /* if (root)\n    return [\n      ...fmRouters,\n      {\n        path: '/',\n        component: () => import('layout/index'),\n        name: 'home',\n        meta: {\n          showNav: 0,\n        },\n      },\n      {\n        path: '*',\n        redirect: '/error/404',\n        enabled: 1,\n        meta: {\n          showNav: 0,\n        },\n      },\n    ]\n  else return fmRouters */\n\n  return fmRouters\n}\n","<script setup>\nimport { defineAsyncComponent, inject, onMounted } from 'vue'\n\nconst globalScrollTop = inject('globalScrollTop')\nconst isLoading = inject('globalIsLoading')\n</script>\n<script>\nimport formatAccess from '@utils/format-access'\nimport findUserRoute from '@utils/find-user-route'\nimport formatRoutes from '@utils/format-routes'\nimport testRoutes from '@utils/test-routes'\nimport asyncRoutes from '@router/async-routes'\n\nexport default {\n  components: {\n    Edit: defineAsyncComponent(() => import('@views/Brands/manager/edit.vue')),\n    // FormLogin: () => import(\"@components/Form/FormLogin.vue\"),\n  },\n  data() {\n    return {\n      remember: { ...this.$store.state.auth.remember },\n      size: 'large',\n      submitData: {\n        email: '',\n        password: '',\n      },\n    }\n  },\n  methods: {\n    async onSubmit() {\n      await this.$refs.form.validate()\n      this.tryToLogin()\n    },\n    async tryToLogin() {\n      await this.$store.dispatch('auth/logIn', this.submitData)\n\n      const updateRememberStore = () => {\n        if (this.remember.flag) {\n          this.$store.dispatch('auth/setRemember', {\n            flag: this.remember.flag,\n            info: {\n              email: this.submitData.email,\n            },\n          })\n        } else {\n          this.$store.dispatch('auth/setRemember', {})\n        }\n      }\n\n      this.tryToFetchPermission()\n      updateRememberStore()\n    },\n    async tryToFetchPermission() {\n      const checkPermission = (routes) => {\n        const {\n          parent: { visible: parentVisible },\n          visible,\n        } = findUserRoute('COM_FRONT_DESK_MANAGER_TITLE', routes)\n        return !!parentVisible && !!visible\n      }\n      const generateValidateRoutes = (routes) => {\n        return asyncRoutes.filter(({ name }) => Object.keys(findUserRoute(name, routes)).length)\n      }\n\n      try {\n        const response = await this.$store.dispatch('auth/fetchUserPage')\n\n        if (checkPermission(response)) {\n          // const userRoutes = formatRoutes(testRoutes)\n          const userRoutes = formatRoutes(response)\n          const userAccess = formatAccess(response)\n          console.time('generateValidateRoutes')\n          const validateRoutes = generateValidateRoutes(userRoutes)\n          console.timeEnd('generateValidateRoutes')\n\n          this.$store.dispatch('auth/storeUserRoutes', userRoutes)\n          this.$store.dispatch('auth/storeUserAccess', userAccess)\n\n          validateRoutes.forEach((route) => {\n            this.$router.addRoute(route)\n          })\n\n          this.$message.success('登入成功')\n          this.$router.push({\n            name: 'COM_BRANDS_MANAGER_TITLE',\n          })\n        } else {\n          this.$store.dispatch('auth/logOut')\n          this.$message.error('帳號權限不足，無法登入')\n        }\n      } catch (e) {\n        this.$store.dispatch('auth/setCurrentUser', {})\n        this.$router.push('/login')\n      }\n    },\n  },\n}\n</script>\n<template>\n  <div :class=\"$style.wrapper\">\n    <transition name=\"form\" appear>\n      <a-card :class=\"$style.form\">\n        <div :class=\"$style.logo\">\n          <img src=\"@assets/images/logo/logo.svg\" style=\" height: 45px;\" />\n        </div>\n        <a-form ref=\"form\" :model=\"submitData\">\n          <a-form-item name=\"email\" required>\n            <a-input v-model:value=\"submitData.email\" placeholder=\"帳號\"></a-input>\n          </a-form-item>\n          <a-form-item name=\"password\" required>\n            <a-input-password v-model:value=\"submitData.password\" placeholder=\"密碼\"></a-input-password>\n          </a-form-item>\n          <a-form-item>\n            <a-checkbox v-model:checked=\"remember.flag\">記住帳號</a-checkbox>\n          </a-form-item>\n          <a-button type=\"primary\" block @click=\"onSubmit\">登入</a-button>\n        </a-form>\n      </a-card>\n    </transition>\n  </div>\n  <Edit/>\n</template>\n<style lang=\"scss\" module>\n.wrapper {\n  background: linear-gradient(to right, #3f6c95 0%, #2f3855 100%);\n  height: 100vh;\n}\n\n.logo {\n  margin-bottom: 25px;\n  text-align: center;\n}\n\n.form {\n  position: absolute;\n  min-width: 300px;\n  max-width: 600px;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background: white;\n  border-radius: 4px;\n  :global {\n    .ant-card-body {\n      padding: 30px;\n    }\n  }\n}\n\n:global {\n  .form-enter-active,\n  .form-leave-active {\n    transition: opacity 1s ease-in-out;\n  }\n\n  .form-enter-from,\n  .form-leave-to {\n    opacity: 0;\n  }\n}\n</style>\n"],"names":["findUserRoute"],"mappings":"4gBAAA,MAAe,mCCAf,KAAM,GAAS,GAEA,WAAsB,EAAS,CAE1C,MAAM,aAAmB,OAIzB,GAAQ,QAAQ,CAAC,CAAE,KAAI,SAAQ,UAAW,CAEtC,AAAI,GAAU,YAAkB,QAC5B,GAAS,EAAa,IAGrB,GAAM,GAAQ,EAAK,QACpB,GAAO,GAAM,EAAK,OAAQ,GAAO,EAAI,UAAY,GAAG,IAAK,GAAO,EAAI,WAErE,GAZI,GCLA,WAAsB,EAAS,EAAO,GAAO,EAAW,OAAW,CAEhF,GAAI,CAAE,aAAmB,QACvB,MAAO,GAGT,GAAI,GAAY,GAChB,SAAQ,QAAQ,AAAC,GAAW,CAE1B,GAAI,CACF,OACA,YACA,YACA,QACA,WACA,SACA,OACA,UACA,OACA,KACA,OACA,QACA,WACE,EAOJ,GAAI,GAAW,AALK,CAAC,GACf,EAAK,OAAS,QAAgB,GAC3B,EAAK,OAAO,KAAK,CAAC,CAAE,aAAc,IAGhB,GAAS,CAGlC,AAAI,GAAU,YAAkB,QAC9B,GAAS,EAAa,EAAQ,GAAO,IAEvC,GAAI,GAAW,CACb,KAAM,GAAa,EAQnB,KAAM,EACN,SAAU,EACV,KAAM,CACJ,OACA,UACA,OACA,KACA,SAAU,GAAY,IAS1B,GANI,GACF,GAAS,SAAW,GAEtB,EAAU,KAAK,GAGX,EAAU,SAAS,SAAW,IAAS,GAAO,CAChD,KAAM,GAAa,CACjB,KAAM,EAAO,QAEb,KAAM,QAAU,EAChB,KAAM,CACJ,OACA,QAAS,EACT,KAAM,WACN,KACA,SAAU,GAAY,IAG1B,EAAU,KAAK,OA4Bd,kOCnGe,SAAO,mBACb,EAAO,4kCASzB,SAAe,CACb,WAAY,CACV,KAAM,EAAqB,IAAM,yDAGnC,MAAO,CACL,MAAO,CACL,SAAU,KAAK,KAAK,OAAO,MAAM,KAAK,UACtC,KAAM,QACN,WAAY,CACV,MAAO,GACP,SAAU,MAIhB,QAAS,MACD,WAAW,CACf,KAAM,MAAK,MAAM,KAAK,WACtB,KAAK,mBAED,aAAa,CACjB,KAAM,MAAK,OAAO,SAAS,aAAc,KAAK,YAE9C,KAAM,GAAsB,IAAM,CAChC,AAAI,KAAK,SAAS,KAChB,KAAK,OAAO,SAAS,mBAAoB,CACvC,KAAM,KAAK,SAAS,KACpB,KAAM,CACJ,MAAO,KAAK,WAAW,SAI3B,KAAK,OAAO,SAAS,mBAAoB,KAI7C,KAAK,uBACL,UAEI,uBAAuB,CAC3B,KAAM,GAAkB,AAAC,GAAW,CAClC,KAAM,CACJ,OAAQ,CAAE,QAAS,GACnB,WACEA,EAAc,+BAAgC,GAClD,MAAO,CAAC,CAAC,GAAiB,CAAC,CAAC,GAExB,EAAyB,AAAC,GACvB,EAAY,OAAO,CAAC,CAAE,UAAW,OAAO,KAAKA,EAAc,EAAM,IAAS,QAGnF,GAAI,CACF,KAAM,GAAW,KAAM,MAAK,OAAO,SAAS,sBAE5C,GAAI,EAAgB,GAAW,CAE7B,KAAM,GAAa,EAAa,GAC1B,EAAa,EAAa,GAChC,QAAQ,KAAK,0BACb,KAAM,GAAiB,EAAuB,GAC9C,QAAQ,QAAQ,0BAEhB,KAAK,OAAO,SAAS,uBAAwB,GAC7C,KAAK,OAAO,SAAS,uBAAwB,GAE7C,EAAe,QAAQ,AAAC,GAAU,CAChC,KAAK,QAAQ,SAAS,KAGxB,KAAK,SAAS,QAAQ,4BACtB,KAAK,QAAQ,KAAK,CAChB,KAAM,iCAGR,MAAK,OAAO,SAAS,eACrB,KAAK,SAAS,MAAM,2EAEtB,CACA,KAAK,OAAO,SAAS,sBAAuB,IAC5C,KAAK,QAAQ,KAAK"}