var j=Object.defineProperty;var R=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var w=(s,t,e)=>t in s?j(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,$=(s,t)=>{for(var e in t||(t={}))O.call(t,e)&&w(s,e,t[e]);if(R)for(var e of R(t))L.call(t,e)&&w(s,e,t[e]);return s};import{_ as M,a as P,f as E,b as S}from"./index-9ec1f801.js";import{U as B,B as A,j as i,o as F,s as q,l as y,n as r,w as l,q as v,W as z,F as G,y as T}from"./vendor-c6516222.js";var K="/cms-build/svg/logo-78329abd.svg";const k={};function D(s){return s instanceof Array?(s.forEach(({id:t,assets:e,apis:a})=>{e&&e instanceof Array&&(e=D(e)),t&&a&&a.length&&(k[t]=a.filter(o=>o.checked===1).map(o=>o.method))}),k):!1}function C(s,t=!1,e=void 0){if(!(s instanceof Array))return!1;let a=[];return s.forEach(o=>{let{path:m,full_path:u,component:_,title:p,redirect:f,assets:c,icon:n,showNav:b,type:I,id:d,edit:U,apis:ae,visible:V}=o;if(V&&(h=>h.type!=="alias"?!0:h.assets.some(({visible:g})=>g))(o)){c&&c instanceof Array&&(c=C(c,!1,d));let h={path:u||m,name:p,children:c,meta:{icon:n,showNav:b,type:I,id:d,parentId:e||d}};if(f&&(h.redirect=f),a.push(h),_.includes("list")&&U!==!1){const g={path:m+"/edit",name:"EDIT-"+p,meta:{icon:n,showNav:0,type:"function",id:d,parentId:e||d}};a.push(g)}}}),a}const W="_wrapper_1hawb_1",H="_logo_1hawb_6",J="_form_1hawb_11";var Q={wrapper:W,logo:H,form:J};const X=y("img",{src:K,style:{height:"45px"}},null,-1),Y=[X],Z=T("\u8A18\u4F4F\u5E33\u865F"),x=T("\u767B\u5165");function ee(s){return A("globalScrollTop"),A("globalIsLoading"),(t,e)=>{const a=i("a-input"),o=i("a-form-item"),m=i("a-input-password"),u=i("a-checkbox"),_=i("a-button"),p=i("a-form"),f=i("a-card"),c=i("Edit");return F(),q(G,null,[y("div",{class:v(t.$style.wrapper)},[r(z,{name:"form",appear:""},{default:l(()=>[r(f,{class:v(t.$style.form)},{default:l(()=>[y("div",{class:v(t.$style.logo)},Y,2),r(p,{ref:(n,b)=>{b.form=n},model:t.submitData},{default:l(()=>[r(o,{name:"email",required:""},{default:l(()=>[r(a,{value:t.submitData.email,"onUpdate:value":e[0]||(e[0]=n=>t.submitData.email=n),placeholder:"\u5E33\u865F"},null,8,["value"])]),_:1}),r(o,{name:"password",required:""},{default:l(()=>[r(m,{value:t.submitData.password,"onUpdate:value":e[1]||(e[1]=n=>t.submitData.password=n),placeholder:"\u5BC6\u78BC"},null,8,["value"])]),_:1}),r(o,null,{default:l(()=>[r(u,{checked:t.remember.flag,"onUpdate:checked":e[2]||(e[2]=n=>t.remember.flag=n)},{default:l(()=>[Z]),_:1},8,["checked"])]),_:1}),r(_,{type:"primary",block:"",onClick:t.onSubmit},{default:l(()=>[x]),_:1},8,["onClick"])]),_:1},8,["model"])]),_:1},8,["class"])]),_:1})],2),r(c)],64)}}const te={components:{Edit:B(()=>S(()=>import("./edit-f6eb296a.js"),["cms-build/js/edit-f6eb296a.js","cms-build/js/index-9ec1f801.js","cms-build/css/index-fdcc14a8.css","cms-build/js/vendor-c6516222.js"]))},data(){return{remember:$({},this.$store.state.auth.remember),size:"large",submitData:{email:"",password:""}}},methods:{async onSubmit(){await this.$refs.form.validate(),this.tryToLogin()},async tryToLogin(){await this.$store.dispatch("auth/logIn",this.submitData);const s=()=>{this.remember.flag?this.$store.dispatch("auth/setRemember",{flag:this.remember.flag,info:{email:this.submitData.email}}):this.$store.dispatch("auth/setRemember",{})};this.tryToFetchPermission(),s()},async tryToFetchPermission(){const s=e=>{const{parent:{visible:a},visible:o}=E("COM_FRONT_DESK_MANAGER_TITLE",e);return!!a&&!!o},t=e=>P.filter(({name:a})=>Object.keys(E(a,e)).length);try{const e=await this.$store.dispatch("auth/fetchUserPage");if(s(e)){const a=C(e),o=D(e);console.time("generateValidateRoutes");const m=t(a);console.timeEnd("generateValidateRoutes"),this.$store.dispatch("auth/storeUserRoutes",a),this.$store.dispatch("auth/storeUserAccess",o),m.forEach(u=>{this.$router.addRoute(u)}),this.$message.success("\u767B\u5165\u6210\u529F"),this.$router.push({name:"COM_BRANDS_MANAGER_TITLE"})}else this.$store.dispatch("auth/logOut"),this.$message.error("\u5E33\u865F\u6B0A\u9650\u4E0D\u8DB3\uFF0C\u7121\u6CD5\u767B\u5165")}catch{this.$store.dispatch("auth/setCurrentUser",{}),this.$router.push("/login")}}}},se=Object.assign(te,{setup:ee}),N={};N.$style=Q;var le=M(se,[["__cssModules",N]]);export{le as default};
//# sourceMappingURL=Index-5c016a3e.js.map
